# NBEmail 自动SMTP配置指南

## 🎯 功能概述

NBEmail 现在支持**自动SMTP配置**功能！系统会：

- 🔍 **自动扫描**您现有的域名邮箱
- 🔧 **自动生成**对应的SMTP服务器配置
- 🎯 **智能生成**用户名和强密码
- 📧 **智能匹配**发件人邮箱与SMTP服务器
- ⚡ **一键配置**，无需手动逐个添加

## 🚀 使用步骤

### 第1步：自动配置
1. 登录NBEmail管理界面
2. 访问 **"SMTP配置"** 页面
3. 点击 **"自动配置"** 按钮
4. 系统自动扫描您的邮箱并生成配置

### 第2步：完善认证信息（可选）
1. 查看自动生成的配置列表（已包含推荐用户名和密码）
2. 如需修改，点击 **"编辑"** 按钮
3. 使用 **"🎯 智能生成"** 重新生成用户名
4. 使用 **"🔑 生成密码"** 重新生成强密码
5. 保存配置

### 第3步：开始使用
- 用什么域名的邮箱发件，系统自动选择对应的SMTP服务器
- 无需手动切换，完全自动化

## 🔧 自动配置原理

### 域名检测
系统会扫描数据库中的所有邮箱地址：
```
user1@company.com    -> 检测到域名: company.com
admin@example.org    -> 检测到域名: example.org
info@mysite.net      -> 检测到域名: mysite.net
```

### SMTP服务器推测
对每个域名，系统会尝试常见的SMTP服务器模式：
```
company.com -> 尝试:
  ✓ mail.company.com:587 (TLS)
  ✓ smtp.company.com:587 (TLS)  
  ✓ mx.company.com:587 (TLS)
  ✓ mail.company.com:25 (无加密)
```

### 连接测试
系统会测试每个SMTP服务器的连通性：
- ✅ **可连接** -> 使用该配置
- ❌ **不可连接** -> 尝试下一个模式
- 🔄 **都不可连接** -> 使用默认配置等待手动修正

## 📋 配置状态说明

### ✅ 已配置
- SMTP服务器地址正确
- 用户名和密码已填写
- 可以正常发送邮件

### ⚠️ 需要认证信息
- SMTP服务器地址已自动配置
- **需要手动填写用户名和密码**
- 点击"编辑"完善信息

### 🔧 自动生成
- 系统根据域名自动推测的配置
- 可能需要调整服务器地址
- 建议测试后使用

## 🎯 使用场景示例

### 场景1：个人多域名
```
我有以下邮箱：
- me@personal.com (个人邮箱)
- work@company.com (工作邮箱)  
- blog@myblog.org (博客邮箱)

自动配置后：
✓ personal.com -> mail.personal.com:587
✓ company.com -> smtp.company.com:587
✓ myblog.org -> mail.myblog.org:587
```

### 场景2：企业多部门
```
公司有以下邮箱：
- hr@company.com (人事部)
- tech@company.com (技术部)
- sales@company.com (销售部)

自动配置后：
✓ 所有 @company.com 邮箱都使用 smtp.company.com
✓ 发件时自动选择正确的SMTP服务器
✓ 无需手动切换配置
```

### 场景3：多品牌管理
```
管理多个品牌：
- info@brand-a.com
- support@brand-b.com
- sales@brand-c.com

自动配置后：
✓ brand-a.com -> mail.brand-a.com:587
✓ brand-b.com -> smtp.brand-b.com:587  
✓ brand-c.com -> mail.brand-c.com:587
```

## ⚙️ 高级配置

### 手动调整SMTP服务器
如果自动检测的服务器不正确：
1. 点击"编辑"配置
2. 修改"SMTP服务器"地址
3. 调整端口和TLS设置
4. 保存配置

### 常见SMTP服务器
```
Gmail:           smtp.gmail.com:587
QQ邮箱:          smtp.qq.com:587
163邮箱:         smtp.163.com:587
腾讯企业邮箱:     smtp.exmail.qq.com:587
阿里云邮箱:       smtp.mxhichina.com:587
Outlook:         smtp-mail.outlook.com:587
```

### 认证信息获取
- **Gmail**: 使用应用专用密码
- **QQ/163**: 使用授权码（非登录密码）
- **企业邮箱**: 使用邮箱密码或专用密码
- **自建邮箱**: 联系管理员获取SMTP认证信息

## 🔍 故障排除

### 自动配置失败
**可能原因：**
- 数据库中没有邮箱记录
- 网络连接问题
- DNS解析失败

**解决方案：**
1. 确保已创建邮箱账户
2. 检查网络连接
3. 手动添加SMTP配置

### 邮件发送失败
**检查步骤：**
1. 确认SMTP服务器地址正确
2. 验证用户名和密码
3. 检查TLS设置
4. 查看系统日志

### 配置不生效
**解决方法：**
1. 刷新配置页面
2. 重新编辑保存配置
3. 重启NBEmail服务

## 💡 最佳实践

### 1. 定期检查配置
- 新增邮箱后运行自动配置
- 定期检查配置状态
- 及时更新认证信息

### 2. 安全建议
- 使用应用专用密码
- 启用TLS加密
- 定期更换密码

### 3. 性能优化
- 删除不用的配置
- 合并相同域名的配置
- 监控发送日志

## 🎉 总结

自动SMTP配置功能让多域名邮件发送变得简单：

1. **一键扫描** - 自动发现所有域名
2. **智能配置** - 自动生成SMTP设置  
3. **简单编辑** - 只需填写认证信息
4. **自动匹配** - 发件时自动选择正确配置

**开始使用：**
访问 SMTP配置页面 → 点击"自动配置" → 编辑认证信息 → 开始发送邮件！

---

**需要帮助？** 查看系统日志或访问使用指南页面。
